# Rust Ingestion Pipeline

Rust documentation is generated by rustdoc, centralized around crates.io and docs.rs.

## Dual-Path Strategy

Two ingestion paths ensure reliability across different environments.

### Path A: Docs.rs ZIP Download (Preferred)

Download pre-built documentation as ZIP archives from docs.rs.

**URL Pattern**: `https://docs.rs/crate/{crate}/{version}/download`

Version can be:

- Specific: `https://docs.rs/crate/serde/1.0.228/download`
- Semver range: `https://docs.rs/crate/serde/~1/download`
- Latest: `https://docs.rs/crate/serde/latest/download`

**Format**: ZIP archive containing HTML documentation for all targets. Requires PKZIP 4.6 / BZIP2 support.

**Parsing**: Use goquery to extract content from rustdoc HTML. The HTML has consistent structure but requires cleanup:

- Strip "Copy" buttons and interactive overlays
- Remove syntax highlighting classes from code blocks
- Handle rustdoc-specific CSS class conventions

**Metadata API**: `https://crates.io/api/v1/crates/{crate}` returns JSON with version history and crate details.

### Path B: Nightly JSON (Alternative)

Generate structured JSON output locally using nightly rustdoc.

**Requirement**: Rust Nightly toolchain

**Command**:

```sh
cargo +nightly rustdoc -- --output-format json -Z unstable-options
```

**Output**: Single JSON file at `target/doc/{crate_name}.json` containing the entire crate's documentation structure.

**JSON Schema**: Defined by the `rustdoc-types` crate. Format version changes between compiler releases (currently v42). Use serde to deserialize into typed structures.

**Risk**: The JSON format remains unstable and requires `-Z unstable-options`. Format version may change without warning between Rust releases.

**Reference Tools**: `rustdoc-md` and `cargo-doc-md` convert rustdoc JSON to Markdown. Their logic can inform our Go implementation.

## Re-export Resolution

Rust's `pub use` re-exports link to original `DefId` in JSON output. Indexing logic must resolve these pointers so searching for `std::io::Result` correctly points to `std::result::Result`.

## Dependencies

- `crates.io` - Crate metadata API
- `docs.rs` - Pre-rendered HTML documentation (ZIP download)
- `cargo +nightly rustdoc` - JSON output generation (optional path)
- `goquery` - HTML parsing for docs.rs path
